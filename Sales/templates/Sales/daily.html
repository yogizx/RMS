{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Daily • Sales Reporting</title>
  <link rel="stylesheet" href="{% static 'Sales/css/styles.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
  <h1>Sales Reporting Analysis Dashboard</h1>
  <div class="filters">
    <form method="get">
      {{ form.start_date }} {{ form.end_date }}
      <button class="btn btn-primary" type="submit">Apply</button>
      <a class="btn" href="{% url 'Sales:export_csv' %}">Export CSV</a>
      <a class="btn" href="{% url 'Sales:export_json' %}">Export JSON</a>
    </form>
  </div>
</header>
<div class="container">
  <div class="grid kpis">
    <div class="card"><div class="kpi"><div><div class="label badge">Total Revenue (Today)</div><div class="value">₹ {{ kpis.revenue.value|floatformat:2 }}</div></div><div class="diff {% if kpis.revenue.diff >= 0 %}positive{% else %}negative{% endif %}">{% if kpis.revenue.diff >= 0 %}+{% endif %}{{ kpis.revenue.diff }}%</div></div></div>
    <div class="card"><div class="kpi"><div><div class="label badge">Orders Today</div><div class="value">{{ kpis.orders.value }}</div></div><div class="diff {% if kpis.orders.diff >= 0 %}positive{% else %}negative{% endif %}">{% if kpis.orders.diff >= 0 %}+{% endif %}{{ kpis.orders.diff }}%</div></div></div>
    <div class="card"><div class="kpi"><div><div class="label badge">Active Customers</div><div class="value">{{ kpis.customers.value }}</div></div><div class="diff {% if kpis.customers.diff >= 0 %}positive{% else %}negative{% endif %}">{% if kpis.customers.diff >= 0 %}+{% endif %}{{ kpis.customers.diff }}%</div></div></div>
    <div class="card"><div class="kpi"><div><div class="label badge">Growth Rate</div><div class="value">₹ {{ kpis.growth.value|floatformat:2 }}</div></div><div class="diff {% if kpis.growth.diff >= 0 %}positive{% else %}negative{% endif %}">{% if kpis.growth.diff >= 0 %}+{% endif %}{{ kpis.growth.diff }}%</div></div></div>
  </div>

  <nav class="section-tabs">
    <a href="{% url 'Sales:daily' %}" class="active">Daily</a>
    <a href="{% url 'Sales:monthly' %}">Monthly</a>
    <a href="{% url 'Sales:products' %}">Products</a>
    <a href="{% url 'Sales:top_sellers' %}">Top Sellers</a>
    <a href="{% url 'Sales:customers' %}">Customers</a>
  </nav>

  <div class="grid" style="grid-template-columns: 2fr 1fr;">
    <div class="card">
      <h3>Daily Sales Trend (Hourly Breakdown)</h3>
      <div class="chart-box">
        <canvas id="hourlyChart"></canvas>
      </div>
    </div>
    <div class="card">
      <h3>Recent Transactions (Live updates)</h3>
      <ul id="live-transactions"></ul>
    </div>
  </div>
</div>
<script>
const hours = {{ hours|safe }};
const revenue = {{ revenue|safe }};
const ctx = document.getElementById('hourlyChart').getContext('2d');
new Chart(ctx, {type:'line',data:{labels:hours,datasets:[{label:'Revenue',data:revenue,fill:false}]},options:{responsive:true,maintainAspectRatio:false}});
</script>
<script src="{% static 'Sales/js/dashboard.js' %}"></script>
</body>
</html>